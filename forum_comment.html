<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Discussion</title>
  <link rel="stylesheet" href="cat.css">
</head>
<body>
  <header>
    <h1 id="postTitle">Discussion</h1>
    <div class="button-row">
      <button class="tile" onclick="location.href='forumTopic.html'">BACK TO TOPIC</button>
    </div>
  </header>

  <main class="container">

    <div class="cat-card" id="postContainer">
    </div>

    <h2>Comments</h2>
    <div class="cat-card" id="commentsContainer">
    </div>

    <h2>Leave a Comment</h2>
    <div class="cat-card">
      <form id="commentForm">
        <textarea id="commentText" rows="4" required style="width:100%;"></textarea><br><br>
        <button type="submit" class="tile">Post Comment</button>
      </form>
    </div>

  </main>

  <script>
    const postContainer = document.getElementById("postContainer");
    const commentsContainer = document.getElementById("commentsContainer");
    const postTitleEl = document.getElementById("postTitle");
    const commentForm = document.getElementById("commentForm");
    const commentInput = document.getElementById("commentText");

    const currentPostId = parseInt(localStorage.getItem("currentPostId"));

    function loadPost() {
      const posts = JSON.parse(localStorage.getItem("forumPosts")) || [];
      return posts.find(p => p.post_id === currentPostId);
    }

    function loadComments() {
      const comments = JSON.parse(localStorage.getItem("forumComments")) || [];
      return comments.filter(c => c.post_id === currentPostId);
    }

    function renderPost() {
      const post = loadPost();
      if (!post) {
        postContainer.innerHTML = "<p>Post not found.</p>";
        return;
      }

      postTitleEl.textContent = post.title;

      postContainer.innerHTML = `
        <h3>${post.title}</h3>
        <p>${post.body}</p>
        <p><small>Posted: ${post.created}</small></p>
      `;
    }

    function renderComments() {
      const comments = loadComments();
      commentsContainer.innerHTML = "";

      if (comments.length === 0) {
        commentsContainer.innerHTML = "<p>No comments yet.</p>";
        return;
      }

      comments.forEach(comment => {
        const div = document.createElement("div");
        div.style.borderBottom = "1px solid #ccc";
        div.style.padding = "8px 0";
        div.innerHTML = `
          <p>${comment.comment_text}</p>
          <p><small>${comment.created}</small></p>
        `;
        commentsContainer.appendChild(div);
      });
    }

    commentForm.addEventListener("submit", function(e) {
      e.preventDefault();

      const text = commentInput.value.trim();
      if (!text) {
        alert("Comment cannot be empty.");
        return;
      }

      const allComments = JSON.parse(localStorage.getItem("forumComments")) || [];

      const newComment = {
        comment_id: Date.now(),
        post_id: currentPostId,
        user_id: 0,
        comment_text: text,
        created: new Date().toLocaleString()
      };

      allComments.push(newComment);
      localStorage.setItem("forumComments", JSON.stringify(allComments));

      commentInput.value = "";
      renderComments();
    });

    document.addEventListener("DOMContentLoaded", function() {
      renderPost();
      renderComments();
    });
  </script>

</body>
</html>
